1. Стратегія резервного копіювання
   1.1. Мета резервного копіювання
   • Забезпечити збереження всіх важливих даних проєкту (коду, конфігурацій, бази даних, логів).
   • Забезпечити можливість відновлення всіх компонентів проєкту в разі збою або помилки.
   1.2. Типи резервних копій
   • Повні резервні копії — створення копії всіх даних (файлів, бази даних) в кожному циклі.
   • Інкрементальні резервні копії — збереження лише змін, що відбулися з моменту останнього резервного копіювання.
   • Диференціальні резервні копії — збереження змін, що відбулися з моменту останньої повної копії.
   1.3. Рекомендується комбінувати типи резервних копій:
   • Щотижневе виконання повних резервних копій.
   • Щоденне виконання інкрементальних або диференціальних резервних копій.

2. Частота створення резервних копій
   2.1. Для коду — здійснювати щоденне бекапування (можна інтегрувати з CI/CD процесами). 2.2. Для бази даних — виконувати резервне копіювання 1-2 рази на день, в залежності від обсягу змін. 2.3. Для файлів конфігурацій — бекапувати при кожному оновленні. 2.4. Для користувацьких даних та логів — виконувати щоденне резервне копіювання або залежно від вимог.

3. Зберігання та ротація копій
   3.1. Зберігання
   • Резервні копії зберігаються на окремих серверах або в хмарних сховищах (наприклад, AWS S3, Google Cloud Storage).
   • Використовувати зашифроване зберігання для чутливих даних.
   3.2. Ротація резервних копій
   • Зберігати резервні копії за останній тиждень у вигляді інкрементальних або диференціальних копій.
   • Окремі повні копії зберігаються на протязі 1-2 місяців для можливості відновлення на старіші версії.
   • Автоматизувати процес видалення застарілих резервних копій (наприклад, зберігати тільки 3 останні повні резервні копії).

4. Процедура резервного копіювання
   4.1. Бази даних
   • Для MySQL: я вже показував для лайт, в мене це робиться теж автоматично в баш файлі)
   mysqldump -u USERNAME -p DB_NAME > /backups/db_backup_$(date +%F).sql
   • Для PostgreSQL:
   pg_dump -U USERNAME -F c DB_NAME > /backups/db_backup_$(date +%F).dump
   4.2. Файли конфігурацій
   • Створення резервної копії .env та важливих конфігураційних файлів:
   cp /var/www/project/.env ~/backups/.env.backup.$(date +%F)
   cp -r /var/www/project/config ~/backups/config_backup_$(date +%F)
   4.3. Користувацькі дані
   • Бекап файлів у папці storage/app/public (для файлів користувача):
   cp -r /var/www/project/storage/app/public ~/backups/public_backup_$(date +%F)
   4.4. Логи системи
   • Зберігання останніх кількох днів логів:
   cp /var/log/nginx/*.log ~/backups/nginx_logs_$(date +%F)
   cp /var/log/php-fpm/*.log ~/backups/php_fpm_logs_$(date +%F)

5. Перевірка цілісності резервних копій
   5.1. Перевірка резервних копій бази даних
   • Перевірити, чи коректно відновлюється база даних з резервної копії:
   mysql -u USERNAME -p NEW_DB_NAME < ~/backups/db_backup_$(date +%F).sql
   • Перевірка за допомогою тестових запитів до відновленої бази даних.
   5.2. Перевірка файлів конфігурацій та даних
   • Визначити, чи всі конфігураційні файли є у резервній копії.
   • Перевірка цілісності папок для користувацьких даних.
   5.3. Перевірка логів
   • Переконатися, що всі важливі логи скопійовано.

6. Автоматизація процесу резервного копіювання
   6.1. Скрипт резервного копіювання (bash)
   #!/bin/bash
# Резервне копіювання бази даних
mysqldump -u USERNAME -p DB_NAME > /backups/db_backup_$(date +%F).sql

# Резервне копіювання конфігураційних файлів
cp /var/www/project/.env ~/backups/.env.backup.$(date +%F)
cp -r /var/www/project/config ~/backups/config_backup_$(date +%F)

# Резервне копіювання користувацьких даних
cp -r /var/www/project/storage/app/public ~/backups/public_backup_$(date +%F)
6.2. Автоматичне виконання за допомогою cron (Linux)
• Налаштування автоматичного запуску бекапів:
crontab -e
# Щоденне резервне копіювання о 2:00
0 2 * * * /path/to/backup-script.sh

7. Процедура відновлення з резервних копій
   7.1. Повне відновлення системи
   7.1.1. Відновлення коду
   • Заміна поточної версії коду на резервну:
   cd /var/www/project
   tar -xzvf ~/backups/project_backup_$(date +%F).tar.gz
   7.1.2. Відновлення бази даних
   mysql -u USERNAME -p DB_NAME < ~/backups/db_backup_$(date +%F).sql
   7.1.3. Відновлення файлів конфігурацій
   cp ~/backups/.env.backup.$(date +%F) /var/www/project/.env
   cp -r ~/backups/config /var/www/project/config
   7.1.4. Перезапуск служб
   sudo systemctl restart nginx
   sudo systemctl restart php-fpm

7.2. Вибіркове відновлення даних
7.2.1. Відновлення лише бази даних
mysql -u USERNAME -p DB_NAME < ~/backups/db_backup_$(date +%F).sql
7.2.2. Відновлення лише файлів конфігурацій
cp ~/backups/.env.backup.$(date +%F) /var/www/project/.env
7.2.3. Відновлення лише користувацьких даних
cp -r ~/backups/public_backup_$(date +%F) /var/www/project/storage/app/public

8. Тестування відновлення
   8.1. Тестувати відновлення на staging-середовищі
   • Запустити процес відновлення на тестовому середовищі.
   • Перевірити, чи всі сервіси працюють коректно після відновлення.
   8.2. Перевірка даних після відновлення
   • Переконатися, що бази даних, файли та конфігурації відновлені належним чином.
   • Запустити тестові запити та перевірити доступність API.
